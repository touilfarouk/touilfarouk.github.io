<!DOCTYPE html>
<html>
   <head>
      <title>Marker Detector</title>
      <style>
         video {
            border: 2px solid;
         }
         canvas {
            border: 2px solid blue;
         }
      </style>
   </head>
   <body>
      <canvas id="myCanvas"></canvas>
      <script src="./markerDetector.js"></script>
      <script>
         var myVideo = document.createElement("video");
         var myCanvas = document.getElementById("myCanvas");
         var ctx = myCanvas.getContext("2d");
         var markerDetector = new MarkerDetector();

         function distance(p1, p2) {
            return Math.sqrt(Math.pow(p1.x - p2.x, 2) + Math.pow(p1.y - p2.y, 2));
         }

         function loop() {
            ctx.drawImage(myVideo, 0, 0, myCanvas.width, myCanvas.height);
            var imgData = ctx.getImageData(0, 0, myCanvas.width, myCanvas.height);
            var res = markerDetector.detect(imgData);
            if (res) {
               ctx.fillStyle = "red";
               for (var i = 0; i < res.leftMarker.points.length; i++) {
                  var point = res.leftMarker.points[i];
                  ctx.fillRect(point.x, point.y, 1, 1);
               }
               ctx.fillStyle = "yellow";
               for (var i = 0; i < res.rightMarker.points.length; i++) {
                  var point = res.rightMarker.points[i];
                  ctx.fillRect(point.x, point.y, 1, 1);
               }
            }
            setTimeout(loop, 16);  // Using setTimeout instead of requestAnimationFrame for better compatibility
         }

         function onSuccess(rawData) {
            myVideo.src = URL.createObjectURL(rawData);
            myVideo.play();
            myVideo.addEventListener('loadeddata', function() {
               myCanvas.width = myVideo.videoWidth;
               myCanvas.height = myVideo.videoHeight;
               loop();
            });
         }

         function onError(err) {
            alert(err);
         }

         // Fallback for getUserMedia
         navigator.getUserMedia = navigator.getUserMedia || navigator.webkitGetUserMedia || navigator.mozGetUserMedia || navigator.msGetUserMedia;

         if (navigator.getUserMedia) {
            navigator.getUserMedia({ video: true }, onSuccess, onError);
         } else {
            alert('getUserMedia is not supported in your browser');
         }
      </script>
   </body>
</html>
